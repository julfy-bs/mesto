(()=>{"use strict";var t,e,n=".form__button",r="popup_active",o=".form",c='[name="link"]',u="Сохранить",a="Сохранение...",s=".feed__item",i=".card__image",l=".card__like-button",d="card__like-button_active",f="card__like-button_liked_true",m=function(t){t.classList.remove(r),function(t){t.removeEventListener("keydown",(function(t){return v(t)})),t.removeEventListener("mousedown",(function(t){return p(t)}))}(t)},p=function(t){var e=t.target.closest(".popup"),n=t.target.classList.contains("popup")||t.target.classList.contains("popup__close");null!==e.querySelector(o)?y(e):m(e),n&&m(e)},v=function(t){if("Escape"===t.key){var e=t.target.closest(".popup");null!==e.querySelector(o)?y(e):m(e)}},h=function(t){t.classList.add(r),function(t){t.addEventListener("keydown",(function(t){return v(t)})),t.addEventListener("mousedown",(function(t){return p(t)}))}(t),setTimeout((function(){return t.focus()}),200)},_=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=t.querySelector(n);r.textContent=e},y=function(t,e){m(t),t.querySelector(o).removeEventListener("submit",e)},b=function(t,e){h(t),t.querySelector(o).addEventListener("submit",e)},S={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"0f9e6763-ca59-4d6a-b788-b6c985602524","Content-Type":"application/json"}},q=function(t){return t.ok?t.json():Promise.reject("Ошибка!".concat(t.statusText," Код ошибки: ").concat(t.status,"."))},L=document.querySelector("#card").content.querySelector(s),x=document.querySelector(".feed__list"),E=document.querySelector(".popup_type_delete"),k=E.querySelector(o),T=document.querySelector(".popup_type_photo"),C=T.querySelector(".popup__image"),g=T.querySelector(".popup__figcaption"),A=[],w=null,D=function(t){t.classList.add(d),t.setAttribute("aria-label",'Убрать отметку "Понравилось"')},U=function(t){t.classList.remove(d),t.setAttribute("aria-label",'Добавить отметку "Понравилось"')},M=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"number"!=typeof n&&console.error("Значение количества лайков карточки должно быть числом"),0===n?(t.classList.remove(f),e.textContent=""):(t.classList.add(f),e.textContent=n)},N=function(e,n){t=0!==e.length&&e.some((function(t){return t._id===n}))},O=function(e,n,r,o,c){var u,a=function(t){return A.find((function(e){return e._id===t}))}(r);switch(N(a.likes,c),t){case!0:(u=r,fetch("".concat(S.baseUrl,"/cards/likes/").concat(u),{method:"DELETE",headers:S.headers}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления лайка карточки. ").concat(t.statusText))}))).then((function(t){N(t.likes,c),a.likes=t.likes})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления лайка карточки: ").concat(t.statusText))}));break;case!1:(function(t){return fetch("".concat(S.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:S.headers}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления лайка карточки. ").concat(t.statusText))}))})(r).then((function(t){N(t.likes,c),a.likes=t.likes})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления лайка карточки: ").concat(t.statusText))}))}var s=Number(n.textContent),i=e.classList.contains(d);i?function(t,e,n){var r=n-1;"number"!=typeof n?console.error("Значение количества лайков карточки должно быть числом"):M(t,e,r)}(e,n,s):function(t,e,n){var r=n+1;"number"!=typeof n?console.error("Значение количества лайков карточки должно быть числом"):M(t,e,r)}(e,n,s),function(t,e){switch(e){case!0:U(t);break;case!1:D(t)}}(e,i)},H=function(t,e){h(T),g.textContent=e.textContent,C.setAttribute("src",t.getAttribute("src")),C.setAttribute("alt",t.getAttribute("alt"))},I=function(t,e){w=function(n){return function(t,e,n){t.preventDefault(),console.warn("TRYING TO DELETE",e,n),_(k);var r=e.closest(s),o=r.querySelector(i),c=r.querySelector(l),a=e;(function(t){return fetch("".concat(S.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:S.headers}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления карточки. ").concat(t.statusText))}))})(n).then((function(){return r.remove()})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления карточки: ").concat(t.statusText))})).finally((function(){var t,e;_(k,u),y(E,(function(t){return w(t)})),k.removeEventListener("submit",(function(t){return w(t)})),w=null,t=a,e=c,o.removeEventListener("mouseup",(function(){return H})),t.removeEventListener("mouseup",(function(){return I})),e.removeEventListener("mouseup",(function(){return O}))}))}(n,t,e)},b(E,(function(t){return w(t)}))},P=function(e,n){var r,o,c=L.cloneNode(!0),u=c.querySelector(".card"),a=u.querySelector(i),s=u.querySelector(".card__title"),d=u.querySelector(".card__like-number"),f=u.querySelector(l),m=u.querySelector(".card__delete"),p=e.likes.length>0?e.likes.length:0;return A.push(e),N(e.likes,n),r=s,o=e.name,r.textContent=o,function(t,e,n){t.setAttribute("src",n),t.setAttribute("alt",e)}(a,e.name,e.link),M(f,d,p),t?D(f):U(f),f.addEventListener("mouseup",(function(){return O(f,d,e._id,e.likes,n)})),a.addEventListener("mouseup",(function(){return H(a,s)})),e.owner._id===n?m.addEventListener("mouseup",(function(){return I(m,e._id)})):m.remove(),c},j=function(t){x.prepend(t)},G=document.querySelector(".popup_type_avatar"),J=document.querySelector(".profile__avatar"),V=document.forms.avatar,B=V.querySelector(c),Y=document.querySelector(".popup_type_edit"),z=document.querySelector(".profile__name"),R=document.querySelector(".profile__image"),W=document.querySelector(".profile__occupation"),F=document.querySelector(".profile__edit"),K=document.forms.profile,Q=K.querySelector('[name="name"]'),X=K.querySelector('[name="occupation"]'),Z=document.querySelector(".popup_type_add"),$=document.querySelector(".profile__add"),tt=document.forms.card,et=(tt.querySelector('[name="title"]'),tt.querySelector(c),function(t){R.setAttribute("src",t)}),nt=function(t){z.textContent=t},rt=function(t){W.textContent=t},ot=function t(e){var n,r,o;e.preventDefault(),_(K),nt(Q.value),rt(X.value),(n={name:Q.value,about:X.value},r=n.name,o=n.about,fetch("".concat(S.baseUrl,"/users/me"),{method:"PATCH",headers:S.headers,body:JSON.stringify({name:r,about:o})}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," обновления информации пользователя. ").concat(t.statusText))}))).then((function(t){nt(t.name),rt(t.about)})).catch((function(t){return console.error("Ошибка ".concat(t.status," редактирования информации профиля: ").concat(t.statusText))})).finally((function(){K.reset(),_(K,u),y(Y,(function(e){return t(e)}))}))},ct=function(){b(Y,(function(t){return ot(t)})),Q.value=z.textContent,X.value=W.textContent},ut=function(t,e,n){t.some((function(t){return!t.validity.valid}))?(e.classList.add(n),e.setAttribute("disabled","disabled")):(e.classList.remove(n),e.removeAttribute("disabled","disabled"))},at=localStorage.getItem("userId")||null;$.addEventListener("mousedown",(function(){var t,e,n;(t={name:"test card",link:"https://images.unsplash.com/photo-1564858763975-d99de59ee4bb?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1742&q=80"},e=t.name,n=t.link,fetch("".concat(S.baseUrl,"/cards"),{method:"POST",headers:S.headers,body:JSON.stringify({name:e,link:n})}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления карточки. ").concat(t.statusText))}))).then((function(t){var e=P(t,t.owner._id);j(e)})).catch((function(t){console.error("Ошибка ".concat(t.status," cоздания карточки: ").concat(t.statusText))})).finally((function(){tt.reset(),_(tt,"Создать"),m(Z)}))})),F.addEventListener("mousedown",(function(){return ct()})),J.addEventListener("mousedown",(function(){b(G,(function(t){return function(t){var e;t.preventDefault(),_(V),(e=B.value,fetch("".concat(S.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:S.headers,body:JSON.stringify({avatar:e})}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," обновления аватара пользователя. ").concat(t.statusText))}))).then((function(t){et(t.avatar)})).catch((function(t){return console.error("Ошибка ".concat(t.status," изменения аватара пользователя: ").concat(t.statusText))})).finally((function(){V.reset(),_(V,u),m(G)}))}(t)}))})),e={formSelector:".form",inputSelector:".form__input",buttonSelector:n,errorSelector:".form__error",inputErrorClass:"form__input_type_error",buttonDisabledClass:"form__button_type_disabled",errorActiveClass:"form__error_active"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return n=t,r=e.inputSelector,o=e.buttonSelector,c=e.errorSelector,u=e.inputErrorClass,a=e.buttonDisabledClass,s=e.errorActiveClass,i=Array.from(n.querySelectorAll(r)),l=n.querySelector(o),ut(i,l,a),i.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,n,r,o){var c=e.parentNode.querySelector(n);e.validity.patternMismatch?e.setCustomValidity(e.dataset.invalidMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n,r,o){n.classList.remove(o),n.textContent="",e.classList.remove(r),e.removeAttribute("aria-describedby")}(0,e,c,r,o):function(t,e,n,r,o,c){n.textContent=r,n.classList.add(c),e.classList.add(o),e.setAttribute("aria-describedby","".concat(c))}(0,e,c,e.validationMessage,r,o)}(0,t,c,u,s),ut(i,l,a)}))})),void n.addEventListener("reset",(function(){setTimeout((function(){return ut(i,l,a)}),0)}));var n,r,o,c,u,a,s,i,l})),document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(S.baseUrl,"/users/me"),{headers:S.headers}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," получения информации о пользователе. ").concat(t.statusText))})).then((function(t){et(t.avatar),nt(t.name),rt(t.about),at=t._id,localStorage.setItem("userId",at)})),fetch("".concat(S.baseUrl,"/cards"),{headers:S.headers}).then((function(t){return q(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," получения информации о карточках. ").concat(t.statusText))})).then((function(t){t.reverse().forEach((function(t){var e=P(t,at);j(e)}))}))}))})();