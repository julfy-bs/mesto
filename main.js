(()=>{"use strict";var t,e,n=".form__button",r="popup_active",o='[name="link"]',c="Сохранить",a="Сохранение...",u=".feed__item",s="card__like-button_active",i="card__like-button_liked_true",l=function(t){!function(t){t.classList.remove(r)}(t),function(t){var e=t.closest(".popup");e.removeEventListener("keydown",f),e.removeEventListener("mousedown",d)}(t)},d=function(t){var e=t.target.closest(".popup");(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&l(e)},f=function(t){if("Escape"===t.key){var e=t.target.closest(".popup");l(e)}},m=function(t){!function(t){t.classList.add(r)}(t),t.addEventListener("keydown",f),t.addEventListener("mousedown",d),setTimeout((function(){return t.focus()}),200)},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=t.querySelector(n);r.textContent=e},p={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"0f9e6763-ca59-4d6a-b788-b6c985602524","Content-Type":"application/json"}},h=function(t){return console.log(t),t.ok?t.json():Promise.reject("Ошибка!".concat(t.statusText," Код ошибки: ").concat(t.status,"."))},_=document.querySelector("#card").content.querySelector(u),y=document.querySelector(".feed__list"),b=document.querySelector(".popup_type_delete"),S=b.querySelector(".form"),L=document.querySelector(".popup_type_photo"),q=L.querySelector(".popup__image"),k=L.querySelector(".popup__figcaption"),E=[],x=function(t){t.classList.add(s),t.setAttribute("aria-label",'Убрать отметку "Понравилось"')},g=function(t){t.classList.remove(s),t.setAttribute("aria-label",'Добавить отметку "Понравилось"')},C=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"number"!=typeof n&&console.error("Значение количества лайков карточки должно быть числом"),0===n?(t.classList.remove(i),e.textContent=""):(t.classList.add(i),e.textContent=n)},T=function(e,n){t=0!==e.length&&e.some((function(t){return t._id===n}))},A=function(e,n){var r,o,a=_.cloneNode(!0),i=a.querySelector(".card"),d=i.querySelector(".card__image"),f=i.querySelector(".card__title"),y=i.querySelector(".card__like-number"),A=i.querySelector(".card__like-button"),w=i.querySelector(".card__delete"),U=e.likes.length>0?e.likes.length:0;return E.push(e),T(e.likes,n),r=f,o=e.name,r.textContent=o,function(t,e,n){t.setAttribute("src",n),t.setAttribute("alt",e)}(d,e.name,e.link),C(A,y,U),t?x(A):g(A),A.addEventListener("click",(function(){return function(e,n,r,o,c){var a,u=function(t){return E.find((function(e){return e._id===t}))}(r);switch(T(u.likes,c),t){case!0:(a=r,fetch("".concat(p.baseUrl,"/cards/likes/").concat(a),{method:"DELETE",headers:p.headers}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления лайка карточки. ").concat(t.statusText))}))).then((function(t){T(t.likes,c),u.likes=t.likes})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления лайка карточки: ").concat(t.statusText))}));break;case!1:(function(t){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:p.headers}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления лайка карточки. ").concat(t.statusText))}))})(r).then((function(t){T(t.likes,c),u.likes=t.likes})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления лайка карточки: ").concat(t.statusText))}))}var i=Number(n.textContent),l=e.classList.contains(s);l?function(t,e,n){var r=n-1;"number"!=typeof n?console.error("Значение количества лайков карточки должно быть числом"):C(t,e,r)}(e,n,i):function(t,e,n){var r=n+1;"number"!=typeof n?console.error("Значение количества лайков карточки должно быть числом"):C(t,e,r)}(e,n,i),function(t,e){switch(e){case!0:g(t);break;case!1:x(t)}}(e,l)}(A,y,e._id,e.likes,n)})),e.owner._id===n?w.addEventListener("click",(function(){m(b),S.addEventListener("submit",(function(t){return function(t,e,n){t.preventDefault(),v(S);var r=e.closest(u);(function(t){return fetch("".concat(p.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:p.headers}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления карточки. ").concat(t.statusText))}))})(n).then((function(){return r.remove()})).catch((function(t){return console.error("Ошибка ".concat(t.status," удаления карточки: ").concat(t.statusText))})).finally((function(){S.reset(),v(S,c),l(b)}))}(t,w,e._id)}))})):w.remove(),d.addEventListener("click",(function(){return function(t,e){m(L),k.textContent=e.textContent,q.setAttribute("src",t.getAttribute("src")),q.setAttribute("alt",t.getAttribute("alt"))}(d,f)})),a},w=function(t){y.prepend(t)},U=document.querySelector(".popup_type_avatar"),D=document.querySelector(".profile__avatar"),N=document.forms.avatar,O=N.querySelector(o),P=document.querySelector(".popup_type_edit"),I=document.querySelector(".profile__name"),M=document.querySelector(".profile__image"),j=document.querySelector(".profile__occupation"),J=document.querySelector(".profile__edit"),H=document.forms.profile,V=H.querySelector('[name="name"]'),z=H.querySelector('[name="occupation"]'),B=document.querySelector(".popup_type_add"),F=document.querySelector(".profile__add"),G=document.forms.card,K=G.querySelector('[name="title"]'),Q=G.querySelector(o),R=function(t){M.setAttribute("src",t)},W=function(t){I.textContent=t},X=function(t){j.textContent=t},Y=function(t,e,n){t.some((function(t){return!t.validity.valid}))?(e.classList.add(n),e.setAttribute("disabled","disabled")):(e.classList.remove(n),e.removeAttribute("disabled","disabled"))},Z=localStorage.getItem("userId")||null;F.addEventListener("mousedown",(function(){m(B)})),G.addEventListener("submit",(function(t){return function(t){var e,n,r;t.preventDefault(),v(G),(e={name:K.value,link:Q.value},n=e.name,r=e.link,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:n,link:r})}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," добавления карточки. ").concat(t.statusText))}))).then((function(t){var e=A(t,t.owner._id);w(e)})).catch((function(t){console.log(t),console.error("Ошибка ".concat(t.status," cоздания карточки: ").concat(t.statusText))})).finally((function(){G.reset(),v(G,"Создать"),l(B)}))}(t)})),J.addEventListener("mousedown",(function(){return m(P),V.value=I.textContent,void(z.value=j.textContent)})),H.addEventListener("submit",(function(t){return function(t){var e,n,r;t.preventDefault(),v(H),W(V.value),X(z.value),(e={name:V.value,about:z.value},n=e.name,r=e.about,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:n,about:r})}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," обновления информации пользователя. ").concat(t.statusText))}))).then((function(t){W(t.name),X(t.about)})).catch((function(t){return console.error("Ошибка ".concat(t.status," редактирования информации профиля: ").concat(t.statusText))})).finally((function(){H.reset(),v(H,c),l(P)}))}(t)})),D.addEventListener("mousedown",(function(){m(U)})),N.addEventListener("submit",(function(t){return function(t){var e;t.preventDefault(),v(N),(e=O.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:e})}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," обновления аватара пользователя. ").concat(t.statusText))}))).then((function(t){R(t.avatar)})).catch((function(t){return console.error("Ошибка ".concat(t.status," изменения аватара пользователя: ").concat(t.statusText))})).finally((function(){N.reset(),v(N,c),l(U)}))}(t)})),e={formSelector:".form",inputSelector:".form__input",buttonSelector:n,errorSelector:".form__error",inputErrorClass:"form__input_type_error",buttonDisabledClass:"form__button_type_disabled",errorActiveClass:"form__error_active"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return n=t,r=e.inputSelector,o=e.buttonSelector,c=e.errorSelector,a=e.inputErrorClass,u=e.buttonDisabledClass,s=e.errorActiveClass,i=Array.from(n.querySelectorAll(r)),l=n.querySelector(o),Y(i,l,u),i.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,n,r,o){var c=e.parentNode.querySelector(n);e.validity.patternMismatch?e.setCustomValidity(e.dataset.invalidMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n,r,o){n.classList.remove(o),n.textContent="",e.classList.remove(r),e.removeAttribute("aria-describedby")}(0,e,c,r,o):function(t,e,n,r,o,c){n.textContent=r,n.classList.add(c),e.classList.add(o),e.setAttribute("aria-describedby","".concat(c))}(0,e,c,e.validationMessage,r,o)}(0,t,c,a,s),Y(i,l,u)}))})),void n.addEventListener("reset",(function(){setTimeout((function(){return Y(i,l,u)}),0)}));var n,r,o,c,a,u,s,i,l})),document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," получения информации о пользователе. ").concat(t.statusText))})).then((function(t){R(t.avatar),W(t.name),X(t.about),Z=t._id,localStorage.setItem("userId",Z)})),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then((function(t){return h(t)})).catch((function(t){return console.error("Ошибка ".concat(t.status," получения информации о карточках. ").concat(t.statusText))})).then((function(t){t.reverse().forEach((function(t){var e=A(t,Z);w(e)}))}))}))})();